(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{0:function(e,n){if(!window.React)throw Error("React must be defined on global variable");e.exports=window.React},204:function(e,n,t){e.exports=t(317)},227:function(e,n,t){},229:function(e,n,t){},317:function(e,n,t){"use strict";t.r(n);var r,a=t(19),o=t.n(a),s=t(32),i=t(60),c=t(0),l=t.n(c),u=t(78),p=t.n(u),d=t(202),w=t(22),f=t(2),v=t(5),m=t(1),b=t(3),g=t(4),h=t(64),_=t(203),y=t(197),x=t.n(y);h.a.plugin(_.a),h.a.plugin(x.a),h.a.plugin(t(219).default),window.PouchDB=h.a,window.session_db=new h.a("session"),window.rapyd_config||(window.rapyd_config={}),window.localStorage.rapyd_server_url||(window.rapyd_config.url?window.localStorage.rapyd_server_url=window.rapyd_config.url:"file:"===window.location.protocol?window.localStorage.rapyd_server_url="http://localhost:8069":window.localStorage.rapyd_server_url=(r=window.location.origin+window.location.pathname).substring(0,r.lastIndexOf("/"))+"/");var j={};function k(){var e=document.getElementById("app");if(e){var n={done:function(e){return j.preload_count-=1,0!=j.preload_count?e:(delete j.preload_count,j.preload_loader.remove(),j.preload_backdrop.remove(),e)}};if(j.preload_count)return j.preload_count+=1,n;j.preload_count=1;var t=document.createElement("div");t.className="preloader-modal",t.insertAdjacentHTML("beforeend",'\n    <div class="preloader color-white">\n      <span class="preloader-inner">\n        <span class="preloader-inner-gap"></span>\n        <span class="preloader-inner-left">\n          <span class="preloader-inner-half-circle"></span>\n        </span>\n        <span class="preloader-inner-right">\n          <span class="preloader-inner-half-circle"></span>\n        </span>\n      </span>\n    </div>');var r=document.createElement("div");return r.className="preloader-backdrop",e.insertAdjacentElement("beforeend",r),e.insertAdjacentElement("beforeend",t),j.preload_loader=t,j.preload_backdrop=r,n}}function E(){return(E=Object(s.a)(o.a.mark(function e(){var n,t,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.session_db,!B.models){e.next=3;break}return e.abrupt("return",{models:B.models,tools:B.tools,local_db:B.local_db});case 3:return e.prev=3,e.next=6,n.get("session");case 6:return t=e.sent,e.prev=7,e.next=10,S({login:t.login,password:t.password,encrypted:!0,client_js_time:t.client_js_time});case 10:if(r=e.sent){e.next=17;break}return e.next=14,I();case 14:window.location.reload(),e.next=18;break;case 17:r.client_js||(r.client_js=t.client_js);case 18:t=r,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(7),console.log(e.t0);case 24:return e.next=26,L(t);case 26:return a=e.sent,B.models=a.models,B.tools=a.tools,B.local_db=a.local_db,e.abrupt("return",a);case 33:throw e.prev=33,e.t1=e.catch(3),e.t1;case 38:case"end":return e.stop()}},e,null,[[3,33],[7,21]])}))).apply(this,arguments)}function O(){return(O=Object(s.a)(o.a.mark(function e(n){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.session_db.get("session");case 2:return t=e.sent,e.next=5,window.session_db.put(Object(i.a)({},t,n));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return(R=Object(s.a)(o.a.mark(function e(n){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.encrypted=!!n.encrypted,n.compress=!0,e.next=4,A("post","json",window.localStorage.rapyd_server_url+"/api/login",n);case 4:if("denied"!==(r=e.sent).status){e.next=9;break}return e.abrupt("return",!1);case 9:if("error"!==r.status){e.next=11;break}throw Error("There are an error on the server");case 11:return n.compress&&P(r.client_js)&&(r.client_js=t(222).LZMA.decompress(D(r.client_js))),console.log(r),e.prev=13,e.next=16,window.session_db.get("session");case 16:a=e.sent,r._rev=a._rev,r.unsaved=a.unsaved,r.client_js=r.client_js||a.client_js,r.client_js_time=r.client_js_time||a.client_js_time,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),r.unsaved={};case 26:return r._id="session",e.next=29,window.session_db.put(r);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}},e,null,[[13,23]])}))).apply(this,arguments)}function I(){return C.apply(this,arguments)}function C(){return(C=Object(s.a)(o.a.mark(function e(){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.session_db.get("session");case 3:return n=e.sent,e.next=6,window.session_db.remove(n);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return window.local_db.destroy(),e.abrupt("return",window.location.reload());case 13:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function L(e){return U.apply(this,arguments)}function U(){return(U=Object(s.a)(o.a.mark(function e(n){var t,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},(new(Function.prototype.bind.apply(Function,[null,"client","export_object",n.client_js])))(B.client,t),(r=t.tools).configuration=Object.assign(r.configuration,window.rapyd_config),r.configuration.url=window.localStorage.rapyd_server_url,(a=t.models).env.context.unsaved=n.unsaved||{},a.env.user=a.env["res.users"].browse(),a.env.user.id=n.id,a.env.user.login=n.login,a.env.user.password=n.password,e.next=13,r.create_data();case 13:return console.log(n),r.configuration.ajax_load=function(e){e.no_preload||(e.preload=k())},r.configuration.ajax_resolve=function(e,n,t){t.no_preload||t.preload.done(),e(n.response)},r.configuration.ajax_reject=function(e,n,t){t.no_preload||t.preload.done(),e(n)},j.exceptionCount=0,r.configuration.exception=function(e){if(j.exceptionCount+=1,e&&Object.keys(r.exceptions).find(function(n){return n===e.type||r.exceptions[n]===e.constructor}))throw"ServerError"!==e.type?j.app.dialog.alert(e.message):j.app.dialog.alert("There are some error"),new Error(e.message);throw j.app.dialog.alert("Network Error"),e},j.warningCount=0,r.configuration.warning=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==j.warningCount)return new Promise(function(n){j.warningCount=0,n(!0),console.warn(e)});n&&j.app.toast.create({text:"You are offline, using local data",closeButton:!0,closeTimeout:1e3}).open(),j.warningCount+=1,console.warn(e)},j.orm_ready(t),e.abrupt("return",t);case 23:case"end":return e.stop()}},e)}))).apply(this,arguments)}function A(e,n,t,r){return void 0!==r&&(r=T(r)),new Promise(function(a,o){var s=new XMLHttpRequest;s.open(e,t,!0),s.onload=function(){a(this.response)},s.onerror=function(){o(this.statusText)},void 0===n&&(n="json"),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.responseType=n;try{s.send(r)}catch(i){o(i)}})}function T(e){var n=[];for(var t in e){var r=e[t];"object"===typeof r?r=JSON.stringify(r):""===r&&(r=null),n.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}return n.join("&")}function P(e){try{return window.btoa(window.atob(e))===e}catch(n){return!1}}function D(e){e=window.atob(e);for(var n=new Uint8Array(e.length),t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}j.orm=new Promise(function(e){return j.orm_ready=e});var B={globals:j,preload:k,get_session:function(){return E.apply(this,arguments)},update_session:function(e){return O.apply(this,arguments)},wait:function(e){return new Promise(function(n,t){setTimeout(function(){return n()},e)})},wait_exist:function(e){return new Promise(function(n,t){var r=setInterval(function(){e()&&(clearInterval(r),n())},0)})},login:S,logout:I,ORM:L,handleClientError:function(e){if(!(B.tools&&e&&Object.values(B.tools.exceptions).find(function(n){return n===e.constructor})))throw e;B.tools.configuration.exception(e)},ajax:A,readAsDataURL:function(e){var n=k();return new Promise(function(n,t){e||t(new Error("No file available"));var r=new FileReader;r.onload=function(e){return n(e.target.result)},r.readAsDataURL(e)}).then(n.done).catch(function(e){throw n.done(),e})},parseURI:T,hasValue:function(e,n){return void 0!==e&&null!==e&&!1!==e&&([Array,String].indexOf(e.constructor)<0&&(e=e.toString()),e.indexOf(n)>-1)},hasKey:function(e,n){return void 0!==e&&null!==e&&!1!==e&&Object.keys(e).indexOf(n)>-1}},M=B,N=function(e){function n(e){var t;return Object(f.a)(this,n),(t=Object(m.a)(this,Object(b.a)(n).call(this,e))).state={username:"",password:""},t}return Object(g.a)(n,e),Object(v.a)(n,[{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){var n,t,r,a,s,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=!0,t=!1,r=void 0,e.prev=3,a=document.querySelectorAll("input[type=text], input[type=password]")[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)s.value.addEventListener("keyup",this.clickEvent.bind(this));e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),t=!0,r=e.t0;case 11:e.prev=11,e.prev=12,n||null==a.return||a.return();case 14:if(e.prev=14,!t){e.next=17;break}throw r;case 17:return e.finish(14);case 18:return e.finish(11);case 19:if(i=M.preload(),!window.rapyd_config.choose_database){e.next=27;break}return e.t1=this,e.next=24,M.ajax("get","json",window.localStorage.rapyd_server_url+"/api/databases");case 24:e.t2=e.sent,e.t3={databases:e.t2},e.t1.setState.call(e.t1,e.t3);case 27:i.done();case 28:case"end":return e.stop()}},e,this,[[3,7,11,19],[12,,14,18]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return l.a.createElement(w.Page,{noToolbar:!0,noNavbar:!0,noSwipeback:!0,loginScreen:!0},l.a.createElement(w.LoginScreenTitle,null,"Welcome"),l.a.createElement(w.List,{form:!0},this.state.databases&&l.a.createElement(w.ListInput,{required:!0,id:"login-page-database",label:"Database",type:"select",onInput:function(n){e.setState({database:n.target.value})}},l.a.createElement("option",{disabled:!0,selected:!0,value:""},"Choose"),this.state.databases&&this.state.databases.map(function(e){return l.a.createElement("option",{style:{color:"#212121"},value:e},e)})),l.a.createElement(w.ListInput,{label:"Username",type:"text",placeholder:"Your username",value:this.state.username,onInput:function(n){e.setState({username:n.target.value})},autofocus:!0}),l.a.createElement(w.ListInput,{label:"Password",type:"password",placeholder:"Your password",value:this.state.password,onInput:function(n){e.setState({password:n.target.value})}}),l.a.createElement(w.Button,{onClick:this.signIn.bind(this),style:{float:"left",marginLeft:"10px"}},"Login"),l.a.createElement(w.Button,{onClick:this.setUrl.bind(this),style:{float:"right",marginRight:"10px"}},"Settings")))}},{key:"clickEvent",value:function(e){e.preventDefault(),13===e.keyCode&&this.signIn()}},{key:"setUrl",value:function(){this.$f7.dialog.prompt("","Server URL",function(e){return localStorage.rapyd_server_url=e});var e=document.querySelector("input.dialog-input");e&&(e.value=localStorage.rapyd_server_url)}},{key:"signIn",value:function(){var e=Object(s.a)(o.a.mark(function e(){var n,t,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=M.preload(),r=(t=this).$f7,e.prev=3,e.next=6,M.login(Object(i.a)({login:t.state.username,password:t.state.password,encrypted:!1},this.state.database?{database:this.state.database}:{}));case 6:if(a=e.sent,n.done(),a){e.next=10;break}return e.abrupt("return",r.dialog.alert("Username/Password wrong, relogin"));case 10:r.dialog.alert("Login Successful!",function(){window.location.reload()}),e.next=18;break;case 13:throw e.prev=13,e.t0=e.catch(3),n.done(),r.dialog.alert("Network Error"),e.t0;case 18:case"end":return e.stop()}},e,this,[[3,13]])}));return function(){return e.apply(this,arguments)}}()}]),n}(l.a.Component),q=function(){return[{path:"(.*)",component:N}]},F=function(e){var n={id:"org.rapyd.client",name:"App",theme:"md",routes:q(),panel:{swipe:"left",leftBreakpoint:960,swipeThreshold:230}};return l.a.createElement(w.App,{params:n,colorTheme:"gray"},l.a.createElement(w.Statusbar,null),l.a.createElement(w.View,{id:"main-view",url:"/",main:!0,className:"ios-edges",preloadPreviousPage:!1,pushState:!0}))},H=(t(225),t(227),t(229),t(139)),J=(t(283),t(198)),Y=t.n(J),G=(t(285),t(199)),V=(t(313),t(315),t(200)),$=t.n(V),K=t(201),W=t.n(K),X=t(80);X.install({onInstalled:function(){return X.update()},onUpdateReady:function(){return M.tools?M.globals.app.dialog.confirm("Update available, apply it?",function(){return X.applyUpdate(function(){return window.location.reload()})}):X.applyUpdate(function(){return window.location.reload()})}}),d.a.use(w.default),window.React=l.a,window.ReactDOM=p.a,window.rapydComponents=Object(i.a)({},w,window.rapydComponents),M.client={api:M,components:window.rapydComponents,selectivity:{Selectivity:H.React,Templates:H.Templates},flatpickr:Y.a,csv:$.a,Framework7Components:w,FileSaver:W.a,AgGridReact:G.AgGridReact},Object(s.a)(o.a.mark(function e(){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=M.get_session();try{window.addEventListener("beforeinstallprompt",function(){var e=Object(s.a)(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,n;case 3:return M.globals.InstallPromp=t,e.next=6,M.wait_exist(function(){return document.getElementById("pwa_install_button")});case 6:document.getElementById("pwa_install_button").style.display="inline-block";case 7:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}())}catch(t){console.error(t)}return e.next=4,n;case 4:if(M.tools){e.next=9;break}return e.abrupt("return",p.a.render(l.a.createElement(F),document.getElementById("app")));case 9:return e.abrupt("return",M.client.init());case 10:case"end":return e.stop()}},e)}))()},78:function(e,n){if(!window.ReactDOM)throw Error("ReactDOM must be defined on global variable");e.exports=window.ReactDOM}},[[204,2,1]]]);
//# sourceMappingURL=main.ea7bfbf4.chunk.js.map